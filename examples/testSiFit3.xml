<beast version='2.0'
       namespace='
            alignment:
            datatype:
            substitutionmodel:
            beast.evolution.alignment:
            beast.core:
            beast.evolution.tree.coalescent:
            beast.core.util:
            beast.evolution.nuc:
            beast.evolution.operators:
            beast.evolution.sitemodel:
            beast.evolution.substitutionmodel:
            beast.evolution.likelihood'>

    <!-- Some random diploid sequence alignment             -->
    <!-- number of taxa = 2                                 -->
    <!-- nchar = 16                                         -->
    <data id='alignment' dataType='ternaryWithError'>
        <sequence taxon='cell_1'>
            0111011101120121
        </sequence>
        <sequence taxon='cell_2'>
            0111022101120122
        </sequence>
    </data>

    <!-- The SiFit3 substitution model (Zafar et al. 1985)  -->
    <input spec='SiFit3' id='siFit'>
        <lambdaD idref='siFit.lambdaD'/>
        <lambdaL idref='siFit.lambdaL'/>
    </input>

    <!-- The site model                                     -->
    <input spec='SiteModel' id='siteModel'>
        <substModel idref='siFit'/>
    </input>

    <input spec='TreeLikelihood' id='treeLikelihood'>
        <data idref='alignment'/>
        <tree idref='tree'/>
        <siteModel idref='siteModel'/>
    </input>

    <parameter id='siFit.lambdaD' value='1.0' lower='0.0'/>
    <parameter id='siFit.lambdaL' value='1.0' lower='0.0'/>

    <tree id='tree'/>

    <!-- The initial tree (upgma or coalescent)             -->
    <tree spec='beast.util.ClusterTree' id='upgmatree' clusterType='upgma' initial='@tree'>
        <taxa idref='alignment'/>
    </tree>

    <!--<tree spec='beast.evolution.tree.RandomTree' id='coalescentSimulator' initial='@tree' taxa='@alignment'>-->
        <!--<populationModel spec='ConstantPopulation'>-->
            <!--<popSize spec='parameter.RealParameter' value='1'/>-->
        <!--</populationModel>-->
    <!--</tree>-->

    <run spec='MCMC' id='mcmc' chainLength='1000000' preBurnin='50000'>

        <init idref='upgmatree'/>
        <distribution spec='CompoundDistribution' id='posterior'>
            <distribution spec='beast.math.distributions.Prior' x='@siFit.lambdaD'>
                <distr spec='beast.math.distributions.OneOnX'/>
            </distribution>
            <distribution spec='beast.math.distributions.Prior' x='@siFit.lambdaL'>
                <distr spec='beast.math.distributions.OneOnX'/>
            </distribution>
            <distribution id='likelihood' idref='treeLikelihood'/>
        </distribution>

        <operator id='lambdaDScaler' spec='ScaleOperator' scaleFactor='0.5' weight='1' parameter='@siFit.lambdaD'/>
        <operator id='lambdaLScaler' spec='ScaleOperator' scaleFactor='0.5' weight='1' parameter='@siFit.lambdaL'/>

        <!--<operator id='treeScaler' spec='ScaleOperator' scaleFactor='0.5' weight='1' tree='@tree'/>-->
        <!--<operator id='subtreeSlide' spec='SubtreeSlide' weight='5' gaussian='true' size='1.0' tree='@tree'/>-->
        <!--<operator id='uniform' spec='Uniform' weight='10' tree='@tree'/>-->
        <!--<operator id='narrow' spec='Exchange' isNarrow='true' weight='1' tree='@tree'/>-->
        <!--<operator id='wide' spec='Exchange' isNarrow='false' weight='1' tree='@tree'/>-->
        <!--<operator id='wilsonBalding' spec='WilsonBalding' weight='1' tree='@tree'/>-->

        <logger logEvery='10000' fileName='testSiFit3.$(seed).log'>
            <model idref='likelihood'/>
            <log idref='likelihood'/>
            <log idref='siFit.lambdaD'/>
            <log idref='siFit.lambdaL'/>
            <log spec='beast.evolution.tree.TreeHeightLogger' tree='@tree'/>
        </logger>

        <logger logEvery='10000' fileName='testSiFit3.$(seed).trees'>
            <log idref='tree'/>
        </logger>

        <logger logEvery='10000'>
            <model idref='likelihood'/>
            <log idref='likelihood'/>
            <ESS spec='ESS' name='log' arg='@likelihood'/>
            <log idref='siFit.lambdaD'/>
            <ESS spec='ESS' name='log' arg='@siFit.lambdaD'/>
            <log idref='siFit.lambdaL'/>
            <ESS spec='ESS' name='log' arg='@siFit.lambdaL'/>
        </logger>
    </run>

</beast>
